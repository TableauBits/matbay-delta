<h1> Welcome to MATBay Δ </h1>

@if(deltaAuth.isAuthenticated() | async) {
Hello {{currentUser?.displayName}} ({{currentUser?.username}}), you have been authenticated by Auth0 and the Δ
server. <br>
<img [src]="currentUser?.imageURL" width="250" height="250" alt="photo de profil de {{currentUser?.imageURL}}">
"{{currentUser?.description}}"
<app-current-user-form></app-current-user-form>
<hr>
<app-constitution-form></app-constitution-form>
<hr>
<h2> Constitutions </h2>
@for (constitution of constitutions.getAll(); track $index) {
<div>
  <h3>{{$index}} - {{constitution.name}} (id : {{constitution.id}}) </h3>
  <hr>
  <p> Description : {{constitution.description}} </p>
  <p> Owner: {{(users.getUser(constitution.owner) | async)?.displayName}} </p>
  <h3> Participants </h3>
  @for (userConstitution of constitution.userConstitution; track $index) {
  <p>
    Participant {{$index}} :
    @if (users.getUser(userConstitution.user) | async; as user) {
    <img [src]="user.imageURL" width="25" height="25" alt="photo de profil de {{user.imageURL}}">
    {{user.displayName}}
    }
  </p>
  }
  <h3> Songs </h3>
  @for (songConstitution of constitution.songConstitution; track $index) {
  @if(songs.getSong(songConstitution.song) | async; as song) {
  <p>
    Song {{$index}} : {{song.title}} (id: {{songConstitution.song}}) from artist (id: {{song.primaryArtist}}) added by
    @if (users.getUser(songConstitution.user) | async; as user) {
    <img [src]="user.imageURL" width="25" height="25" alt="photo de profil de {{user.imageURL}}">
    {{user.displayName}}
    }
  </p>
  }
  }
  @if(constitution.songConstitution.length === 0) {
  No song.
  }
  <app-add-song-form [constitution]="constitution.id"></app-add-song-form>
  <div>
    <button (click)="constitutions.join(constitution.id)"> Join constitution </button>
    <button (click)="constitutions.leave(constitution.id)"> Leave constitution </button>
  </div>
</div>
}
<button (click)="deltaAuth.logout()"> Log out </button>
} @else {
Please log in with your TableauBits account to access the app. <br>
<button (click)="deltaAuth.login()"> Log in </button>
}